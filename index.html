<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Student Marks Table Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    .section { margin-bottom: 28px; }
    table { border-collapse: collapse; width: 95%; margin-top: 16px; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
    th { background: #f0f0f0; }
    input[type="number"], input[type="text"] { width: 90%; padding: 2px; }
    .btn { padding: 6px 12px; font-size: 16px; }
    .result-table { width: 60%; margin-bottom: 30px; }
    .result-table th { background: #e0e0f0; }
    .summary-box { margin-bottom: 22px; }
  </style>
</head>
<body>
  <h1>Dynamic Student Marks Table Generator</h1>

  <div class="section" id="setupSection">
    <form id="setupForm" onsubmit="event.preventDefault(); showSubjectsForm();">
      <label>How many subjects?
        <input type="number" id="subjectCount" min="1" max="20" required>
      </label>
      <br><br>
      <label>How many students?
        <input type="number" id="studentCount" min="1" max="100" required>
      </label>
      <br><br>
      <button type="submit" class="btn">Next</button>
    </form>
  </div>

  <div class="section" id="subjectsSection" style="display:none;">
    <form id="subjectsForm" onsubmit="event.preventDefault(); showNamesPrompt();">
      <div id="subjectsInputs"></div>
      <br>
      <button type="submit" class="btn">Next</button>
    </form>
  </div>

  <div class="section" id="namesPromptSection" style="display:none;">
    <span>Do you want to input the names of the students as well?</span>
    <button class="btn" onclick="generateTable(true)">Yes</button>
    <button class="btn" onclick="generateTable(false)">No</button>
  </div>

  <div class="section" id="marksTableSection" style="display:none;">
    <form id="marksForm" onsubmit="event.preventDefault(); processMarks();">
      <div id="marksTableContainer"></div>
      <br>
      <button type="submit" class="btn">Save Marks</button>
    </form>
  </div>

  <div class="section" id="resultsSection" style="display:none;">
    <h2>Results</h2>
    <div id="resultsDisplay"></div>
  </div>

  <script>
    let subjectCount = 0, studentCount = 0, subjects = [], subjectMaxMarks = [], askNames = false;

    function showSubjectsForm() {
      subjectCount = parseInt(document.getElementById('subjectCount').value, 10);
      studentCount = parseInt(document.getElementById('studentCount').value, 10);
      if (!subjectCount || !studentCount) return;
      let html = '';
      for (let i = 1; i <= subjectCount; i++) {
        html += `<label>Subject ${i} Name: <input type="text" required id="subName${i}" placeholder="Subject ${i}"></label>
                 <label> Max Marks: <input type="number" min="1" required id="subMarks${i}"></label><br><br>`;
      }
      document.getElementById('subjectsInputs').innerHTML = html;
      document.getElementById('setupSection').style.display = 'none';
      document.getElementById('subjectsSection').style.display = '';
    }

    function showNamesPrompt() {
      subjects = [];
      subjectMaxMarks = [];
      for (let i = 1; i <= subjectCount; i++) {
        subjects.push(document.getElementById(`subName${i}`).value.trim() || `Subject ${i}`);
        subjectMaxMarks.push(parseInt(document.getElementById(`subMarks${i}`).value, 10) || 0);
      }
      document.getElementById('subjectsSection').style.display = 'none';
      document.getElementById('namesPromptSection').style.display = '';
    }

    function generateTable(withNames) {
      askNames = withNames;
      document.getElementById('namesPromptSection').style.display = 'none';
      let table = '<table><thead><tr><th>Roll No.</th>';
      if (askNames) table += '<th>Name</th>';
      for (let i = 0; i < subjectCount; i++) {
        table += `<th>${subjects[i]}<br>(Max: ${subjectMaxMarks[i]})</th>`;
      }
      table += '</tr></thead><tbody>';
      for (let r = 1; r <= studentCount; r++) {
        table += `<tr><td>${r}</td>`;
        if (askNames) table += `<td><input type="text" placeholder="Student ${r}" name="studentName${r}"></td>`;
        for (let s = 0; s < subjectCount; s++) {
          table += `<td><input type="number" min="0" max="${subjectMaxMarks[s]}" name="marks_${r}_${s}"></td>`;
        }
        table += '</tr>';
      }
      table += '</tbody></table>';
      document.getElementById('marksTableContainer').innerHTML = table;
      document.getElementById('marksTableSection').style.display = '';
    }

    function processMarks() {
      // Read marks and names from table
      let students = [];
      for (let r = 1; r <= studentCount; r++) {
        let student = {
          roll: r,
          name: askNames ? document.getElementsByName("studentName" + r)[0].value.trim() : "",
          marks: [],
          total: 0,
          percent: 0
        };
        let actualSubjects = 0, totalMarks = 0;
        for (let s = 0; s < subjectCount; s++) {
          let input = document.getElementsByName(`marks_${r}_${s}`)[0];
          let val = input.value;
          if (val !== "") {
            let num = parseFloat(val);
            student.marks[s] = num;
            totalMarks += num;
            actualSubjects++;
          } else {
            student.marks[s] = null;
          }
        }
        student.total = totalMarks;
        student.percent = actualSubjects ? (totalMarks / actualSubjects).toFixed(2) : "N/A";
        students.push(student);
      }

      // Per-subject stats
      let subjectStats = subjects.map((sub, idx) => {
        let total = 0, count = 0, marksArr = [];
        students.forEach(stu => {
          if (stu.marks[idx] !== null && stu.marks[idx] !== undefined) {
            total += stu.marks[idx];
            marksArr.push(stu.marks[idx]);
            count++;
          }
        });
        return {
          name: sub,
          avg: count ? (total / count).toFixed(2) : "N/A",
          marks: marksArr,
          count: count
        };
      });

      // Display
      let resultsHTML = "";

      // Student summary table
      resultsHTML += `<div class="summary-box"><b>Student Summary</b><br>
      <table class="result-table"><thead><tr><th>Roll No.</th>`;
      if (askNames) resultsHTML += `<th>Name</th>`;
      resultsHTML += `<th>Total</th><th>Average %</th></tr></thead><tbody>`;
      students.forEach(stu => {
        resultsHTML += `<tr><td>${stu.roll}</td>`;
        if (askNames) resultsHTML += `<td>${stu.name}</td>`;
        resultsHTML += `<td>${stu.total}</td><td>${stu.percent}</td></tr>`;
      });
      resultsHTML += `</tbody></table></div>`;

      // Per subject table
      subjectStats.forEach((stat, idx) => {
        resultsHTML += `<div class="summary-box"><b>Subject: ${stat.name}</b><br>
        <span>Average marks (only among students who took this subject): <b>${stat.avg}</b></span>
        <table class="result-table"><thead><tr><th>Roll No.</th>`;
        if (askNames) resultsHTML += `<th>Name</th>`;
        resultsHTML += `<th>Marks</th></tr></thead><tbody>`;
        students.forEach(stu => {
          if (stu.marks[idx] !== null && stu.marks[idx] !== undefined) {
            resultsHTML += `<tr><td>${stu.roll}</td>`;
            if (askNames) resultsHTML += `<td>${stu.name}</td>`;
            resultsHTML += `<td>${stu.marks[idx]}</td></tr>`;
          }
        });
        resultsHTML += `</tbody></table></div>`;
      });

      document.getElementById('resultsDisplay').innerHTML = resultsHTML;
      document.getElementById('resultsSection').style.display = '';
      window.scrollTo({top: document.body.scrollHeight, behavior: "smooth"});
    }
  </script>
</body>
</html>
